# How have payments and receipts for the use of intellectual property evolved relative to each other in Eswatini between 1978 and 2023?

import pandas as pd
import matplotlib.pyplot as plt
import os

# Folders
data_raw_folder = "data_raw/"
data_clean_folder = "data_clean/"
figures_folder = "figures/"

# Load CSV
filename = "science-and-technology_swz_filtered.csv"  # Filtered dataset with only relevant rows
df = pd.read_csv(os.path.join(data_raw_folder, filename))

# Keep only needed columns
df = df[["Year", "Indicator Name", "Value"]]

# Convert Year and Value to numeric, drop invalid rows
df["Year"] = pd.to_numeric(df["Year"], errors="coerce")
df["Value"] = pd.to_numeric(df["Value"], errors="coerce")
df = df.dropna(subset=["Year", "Value"])

# Pivot indicators into separate columns
df_pivot = df.pivot(index="Year", columns="Indicator Name", values="Value").reset_index()
df_pivot = df_pivot.sort_values("Year")

print("Pivoted Eswatini dataset:")
display(df_pivot)

# Interpolate missing values for smooth plotting (optional)
df_plot = df_pivot.interpolate(method='linear')

# Plot the indicators
plt.figure(figsize=(10,6))
plt.plot(df_plot["Year"], df_plot["Charges for the use of intellectual property, payments (BoP, current US$)"], 
         marker='o', linestyle='-', label="Charges for the use of intellectual property, payments (BoP, current US$)")
plt.plot(df_plot["Year"], df_plot["Charges for the use of intellectual property, receipts (BoP, current US$)"], 
         marker='o', linestyle='-', label="Charges for the use of intellectual property, receipts (BoP, current US$)")

plt.title("Eswatini: Payment vs Receipt charges for the use of intellectual property  (BoP, current US$) (1978-2023)")
plt.xlabel("Year")
plt.ylabel("Amount (in hundreds of millions of dollars)")
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.savefig(os.path.join(figures_folder, "eswatini_payment_vs_receipt_charges_for_the_use_of_intellectual_property.png"))
plt.show()

# Save cleaned CSV
df_pivot.to_csv(os.path.join(data_clean_folder, "eswatini_payment_vs_receipt_charges_for_the_use_of_intellectual_property"), index=False)
